<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<title>yelp api</title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link rel="stylesheet" href="dist/css/main.css">
		
	</head>
	<body>

		<form>
			<label>Business Type:
				<input type="text" name="term" id="term" placeholder="type" />
			</label>
			<label>Business Location:
				<input type="text" name="location" id="location" placeholder="location" />
			</label>
			<br/>
			<label>Price Level:
				<label>
					<input type="checkbox" name="price" value="1" />
				</label> $
				<label>
					<input type="checkbox" name="price" value="2"; />
				</label> $$
			</label>
			<br/>=
			<a href="#" id="search">Search</a>
		</form>

		<hr/>
		<ul id="results"></ul>
		

		<script src="dist/js/main.js"></script>

	</body>
</html>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript">

(function(){

	const API_KEY = "2-eO6_aZS3e3d9Q35TFJ8OAyiFXsSS9X3jqYz_A2fMGZjwnckl6kDHcqJRuF-T261k7jC6qWLnEUIvi5-l-qw7JeHANXoNtnF3Y0VC02R-KJywyBqm5vI6TISGPiWnYx";
	const clientID = "69Va0F6exzvxb4JXXkc_bg";

	const termEl = document.getElementById('term');
	const locationEl = document.getElementById('location');
	const searchBtn = document.getElementById('search');
	const resultsEl = document.getElementById('results');



	searchBtn.addEventListener('click', function(e){
		e.preventDefault();
		const queryTerm = termEl.value;
		const location = locationEl.value;
		console.log(`The business type you entered is: `, queryTerm);
		console.log(`The location you entered is: `, location);

		searchYelp(location, queryTerm);

	})

	function displayArticles(article){
		const title = businesses.name;
		console.log("the name of this business is: ", title);

		let location = businesses.location.display_address;
		console.log("the location of this business is: ", location);

		let rating = businesses.rating;
		console.log("the rating for this business is: ", rating);

		let price = businesses.price;
		console.log("the price range for this business is: ", price);

		let thumbnail = 'http://support.yumpu.com/en/wp-content/themes/qaengine/img/default-thumbnail.jpg';
		if( businesses.image_url && businesses.image_url.length) {
			thumbnail = businesses.image_url;}
		console.log("the thumbnail for this business is: ", thumbnail);
		
		const url = businesses.url;
		console.log("the url of this business is: ", url);

		const liEl = document.createElement('li');
		const linkEl = document.createElement('a');
		const imgEl = document.createElement('img');
		const div = document.createElement('div');

		const pTitleEl = document.createTextNode(title);
		const pLocationEl = document.createTextNode(location);
		const pRatingEl = document.createTextNode(rating);
		const pPriceEl = document.createTextNode(price);

		linkEl.href = url;
		imgEl.src = thumbnail; 

		liEl.appendChild(linkEl);

		linkEl.appendChild(pTitleEl);
		linkEl.appendChild(pLocationEl);
		linkEl.appendChild(pRatingEl);
		linkEl.appendChild(pPriceEl);
		linkEl.appendChild(imgEl);

		document.body.appendChild(liEl);
	}

	function displayArticles(articleArray){

		resultsEl.innerHTML = '';

		if (articleArray && articleArray.length && articleArray.length > 0) {

			articleArray.forEach(function(article){
				console.log('article', article);
				displayArticle(article);
			})
		} else {
			console.warn("No articles found!")
			//also show message in the page
		}
	}


	function searchYelp(location, queryTerm){
		axios.get('https://circuslabs.net/proxies/yelp-fusion-proxy/', {
  			params: {
  				'_ep': '/businesses/search',
  				'term': queryTerm,
  				'location': location
  			},

  			headers: {
  				'Authorization': 'Bearer ' + API_KEY
  			}
  		})
		
		.then(function (response) {
			console.log('response:', response.data, response)

			displayArticles(response.data, respose.docs);
		})
  		} 

})()
</script>
